<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8"> 
<title>猎鹰实时位置</title> 
</head>
<body>

猎鹰实时位置
<form name="locform">
API Key：<input id="apikey" type="text" name="apikey" value="83e2d15dcc58179073ee4a85921a5d45"><br>
服务id：<input id="sid" type="number" name="sid" value="389577"><br>
终端id：<input id="tid" type="number" name="tid" value="392138274"><br>
纠偏：<input id="correction" type="text" name="correction" value="n"><br>
<input type="button" id="refresh" value="刷新">
</form>
<p name="out_frame" id="out_frame"></p>
<div id="container" style="width:300px; height: 180px;"></div> 
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=f19a1cb078ff7ffa64ab4cbae7480caf"></script> 
<script>
window.onLoad  = function() {
  var map = new AMap.Map('container');
}
  
function formatDate(datetime) {
  var date = new Date(datetime);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
  var year = date.getFullYear(),
      month = ("0" + (date.getMonth() + 1)).slice(-2),
      sdate = ("0" + date.getDate()).slice(-2),
      hour = ("0" + date.getHours()).slice(-2),
      minute = ("0" + date.getMinutes()).slice(-2),
      second = ("0" + date.getSeconds()).slice(-2);
  // 拼接
  var result = year + "-"+ month +"-"+ sdate +" "+ hour +":"+ minute +":" + second;
  return result;
}

function refreshLoc() {
  document.getElementById("out_frame").innerHTML="...";
  var apikey=document.locform.apikey.value;
  var sid=document.locform.sid.value;
  var tid=document.locform.tid.value;
  var correction=document.locform.correction.value;
  var getRequest = new XMLHttpRequest();
  getRequest.onreadystatechange = function() { 
      if (getRequest.readyState == 4 && getRequest.status == 200) {
        console.log(getRequest.responseText);
        var result=JSON.parse(getRequest.responseText);
        var dateTime=formatDate(result.data.locatetime);
        console.log("locatetime: " + dateTime);
        var geoRequest = new XMLHttpRequest();
        var geoUrl = "https://restapi.amap.com/v3/geocode/regeo?key=" + apikey + "&location=" + result.data.location;
        console.log("geoUrl: " + geoUrl);
        geoRequest.onreadystatechange = function() { 
          if (geoRequest.readyState == 4 && geoRequest.status == 200) {
            console.log(geoRequest.responseText);
            var geoInfo = JSON.parse(geoRequest.responseText);
            var address = geoInfo.regeocode.formatted_address;
            document.getElementById("out_frame").innerHTML="time: " + dateTime 
              + "<br>location:" + result.data.location
              + "<br>address: " + address;
          }
        }
        geoRequest.open("GET", geoUrl, true);
        geoRequest.send(null);
      }
  }
  var url = "https://tsapi.amap.com/v1/track/terminal/lastpoint?key=" + apikey
    + "&sid=" + sid
    + "&tid=" + tid
    + "&correction=" + correction;
  getRequest.open("GET", url, true);
  getRequest.send(null);
}

document.getElementById("refresh").onclick = refreshLoc;
</script>
</body>
</html>